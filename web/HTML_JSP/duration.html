<!--

  Created by IntelliJ IDEA.
  User: 1105379011
  Date: 2018/10/23
  Time: 19:58
  To change this template use File | Settings | File Templates.
-->
<!DOCTYPE html>
<html lang="">
<head>
    <title>课程管理</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../bootstrap-4.1.3-dist/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="../CSS/navigation.css">
    <link rel="stylesheet" type="text/css" href="../CSS/main_css/Myclass.css">
    <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.css">
    <link rel="stylesheet" href="../CSS/dateUI/element.min.css">
</head>
<style type="text/css">
    body.modal-open {
        overflow-y: auto !important;
        padding-right: 0!important;
    }
</style>

<body>
<div id="navigation"></div>
<div>
    <div>
        <div id="ui_box"></div>
        <div class="main_box">
            <div id="course_manag_nav"></div>
            <div class="container_right">
                <h3 class="container_right_head">
                    基本信息
                </h3>
                <div id="chooseDate">
                    <template>
                        <div class="block">
                            <el-date-picker v-model="value9" type="daterange" start-placeholder="开始日期" end-placeholder="结束日期" default-value="2019-10-01" @change="getMyDateTime()"></el-date-picker>
                            <span>您选择的：{{value9}}</span>
                        </div>
                    </template>
                </div>
                <div id="main" style="width: 800px;height:400px;"></div>
            </div>
        </div>
    </div>
</div>

</body>
<script src="https://cdn.staticfile.org/jquery/3.2.1/jquery.min.js"></script>
<script src="../bootstrap-4.1.3-dist/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../JS/LoginPC.js"></script>
<script type="text/javascript" src="../JS/main_js/Myclass.js"></script>
<script type="text/javascript"  src="../JS/echarts.min.js"></script>
<script type="text/javascript" src="../JS/dateUI/vue.min.js" ></script>
<script type="text/javascript" src="../JS/dateUI/element.min.js"></script>
<script type="text/javascript">
    $(document).ready(function(){
        $('#navigation').load('navigation_dark.html',function () {
            get_user_infor();
            get_viewed()
        });
        $('#ui_box').load('ui_box.html',function () {
            getHTML();
        });
        $('#course_manag_nav').load('course_manag_nav.html',function () {
            addHref();
            addAction(3)
        });
    });


    new Vue({
        el: '#chooseDate',
        data() {
            return {
                value9: ''
            }
        },
        methods: {
            getMyDateTime(value9) {
                console.log(value9);//结果为一个数组，如：2018-12-02T03:24:02.000Z，想要我们需要的时间格式，要进行Date的操作
            }
        }
    });

    function get_viewed() {
        var time=[];
        for (var i=7;i>0;i--){
            var curDate = new Date();
            time.push(new Date(curDate.setDate(curDate.getDate()-i)).Format("yyyyMMdd"));
        }
        var times=[];
        $.ajax({
            type:"POST",
            url:getContextPath()+"/play",
            data:{
                action:'get_viewed',
                class_id:No,
                start:time[0],
                end:time[time.length-1]
            },
            dataType:'json',
            success:function (json) {
                //console.log(json.viewed);
                for (var i=0;i<time.length;i++){
                    for (var j=0;j<json.viewed.length;j++){
                        if (time[i]===json.viewed[j].substr(0,8)){
                            times.push(json.viewed[j].substring(8,json.viewed[j].length));
                            break;
                        }
                    }
                    if (times[i]===undefined) times.push(0);
                }
                view(time,times);
            }
        });

    }

    function view(time,times) {
        // 基于准备好的dom，初始化echarts实例
        var myChart = echarts.init(document.getElementById('main'));
        // 指定图表的配置项和数据
        var option = {
            tooltip : {
                trigger: 'axis'
            },
            xAxis: {
                type: 'category',
                name: '日期',
                data: time
            },
            yAxis: {
                minInterval: 1,
                name: '播放次数',
                type: 'value'
            },
            series: [{
                data: times,
                type: 'line'
                /*color:'#61a0a8'*/
            }]
        };
        // 使用刚指定的配置项和数据显示图表。
        myChart.setOption(option);
    }

    Date.prototype.Format = function (fmt) {
        var o = {
            "M+": this.getMonth() + 1, //月份
            "d+": this.getDate(), //日
            "H+": this.getHours(), //小时
            "m+": this.getMinutes(), //分
            "s+": this.getSeconds(), //秒
            "q+": Math.floor((this.getMonth() + 3) / 3), //季度
            "S": this.getMilliseconds() //毫秒
        };
        if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
        for (var k in o)
            if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length === 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
        return fmt;
    };
</script>
</html>
